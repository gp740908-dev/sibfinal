
-- 1. Create Experiences Table (Layanan/Aktivitas)
-- Digunakan untuk halaman Experiences.tsx dan OurServices.tsx
create table public.experiences (
  id uuid not null default gen_random_uuid (),
  title text not null,
  description text not null,
  category text not null, -- 'Culinary', 'Wellness', 'Adventure', 'Transport'
  image_url text not null,
  price_start_from numeric null, -- Opsional, jika ingin menampilkan harga
  cta_label text default 'Inquire Now',
  created_at timestamp with time zone not null default now(),
  constraint experiences_pkey primary key (id)
);

-- 2. Create Reviews Table (Testimoni)
-- Digunakan untuk komponen GuestDiaries.tsx
create table public.reviews (
  id uuid not null default gen_random_uuid (),
  guest_name text not null,
  quote text not null,
  source text null, -- Misal: 'Architecture Digest', 'Google Review', atau asal negara
  rating integer default 5,
  image_url text null, -- Foto tamu atau suasana saat mereka menginap
  is_featured boolean default false, -- Untuk menandai review yang muncul di Homepage
  created_at timestamp with time zone not null default now(),
  constraint reviews_pkey primary key (id)
);

-- 3. Create Subscribers Table (Newsletter)
-- Digunakan untuk form di Journal.tsx
create table public.subscribers (
  id uuid not null default gen_random_uuid (),
  email text not null unique,
  subscribed_at timestamp with time zone not null default now(),
  constraint subscribers_pkey primary key (id)
);

-- 4. Create Inquiries Table (Leads)
-- Untuk menyimpan data orang yang klik 'Contact Agent' atau mengisi form (jika ada form nanti)
create table public.inquiries (
  id uuid not null default gen_random_uuid (),
  name text,
  email text,
  message text,
  type text default 'general', -- 'booking', 'collaboration', 'general'
  status text default 'new', -- 'new', 'contacted', 'resolved'
  created_at timestamp with time zone not null default now(),
  constraint inquiries_pkey primary key (id)
);

-- 5. Enable Row Level Security (RLS)
alter table public.experiences enable row level security;
alter table public.reviews enable row level security;
alter table public.subscribers enable row level security;
alter table public.inquiries enable row level security;

-- 6. Create Policies

-- Experiences & Reviews: Public Read (Semua orang bisa baca)
create policy "Public can read experiences" on public.experiences for select using (true);
create policy "Public can read reviews" on public.reviews for select using (true);

-- Subscribers & Inquiries: Public Insert (Semua orang bisa input/submit)
create policy "Public can subscribe" on public.subscribers for insert with check (true);
create policy "Public can submit inquiries" on public.inquiries for insert with check (true);

-- Hanya Admin/Service Role yang bisa baca data sensitif (Subscriber & Inquiries)
-- (Catatan: Di Supabase Dashboard Anda otomatis jadi admin, jadi bisa lihat datanya)

-- 7. Insert Seed Data (Data Dummy sesuai Website saat ini)

-- Seed Experiences (UPDATED IMAGES)
insert into public.experiences (title, category, description, image_url, cta_label) values
  ('Private Dining', 'Culinary', 'Our culinary team brings the restaurant to your sanctuary. From floating breakfasts in your infinity pool to 7-course degustation dinners featuring locally sourced ingredients.', 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&q=80&w=1200', 'View Sample Menu'),
  ('Holistic Healing', 'Wellness', 'Ancient Balinese healing traditions delivered to your doorstep. Experience a traditional Boreh scrub, a flower bath ritual, or sound healing.', 'https://images.unsplash.com/photo-1600334089648-b0d9d3028eb2?auto=format&fit=crop&q=80&w=1200', 'View Spa Menu'),
  ('Sacred Tours', 'Adventure', 'Gain exclusive access to water temples for a purification ceremony (Melukat), trek through private rice terraces at sunrise, or explore hidden waterfalls.', 'https://images.unsplash.com/photo-1537953773345-d172ccf13cf1?auto=format&fit=crop&q=80&w=1200', 'Explore Itineraries'),
  ('Vintage Land Rover', 'Transport', 'Navigate the island in timeless style. Our fleet of restored vintage Land Rovers and premium SUVs are available for airport transfers and daily excursions.', 'https://images.unsplash.com/photo-1562967204-c3dd30472cb3?auto=format&fit=crop&q=80&w=1200', 'Check Availability');

-- Seed Reviews
insert into public.reviews (guest_name, quote, source, image_url, is_featured) values
  ('Elena S.', 'I have never slept so deeply. The sounds of the river and the privacy of the villa created a sanctuary I didn''t know I needed.', 'Architecture Digest', 'https://images.unsplash.com/photo-1515377905703-c4788e51af15?auto=format&fit=crop&q=80&w=1000', true),
  ('Marcus & Sarah', 'The floating breakfast was the highlight of our honeymoon. Every detail was perfect.', 'Google Review', 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&q=80&w=1000', false);
